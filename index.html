<script>
  // Firebase конфіг
  const firebaseConfig = {
    apiKey: "AIzaSyDTqQbagHh-HLAdNI56wEsgayUSNcmDJyg",
    authDomain: "webkv-6a265.firebaseapp.com",
    projectId: "webkv-6a265",
    storageBucket: "webkv-6a265.firebasestorage.app",
    messagingSenderId: "261103939337",
    appId: "1:261103939337:web:7981bbce2a277693026dd8",
    measurementId: "G-3QQR2K785N"
  };

  // Ініціалізація Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const tableBody = document.getElementById('tableBody');
  const entries = [];

  const startDate = new Date('2025-07-10'); // початок (оновлюй за потреби)
  const daysToGenerate = 90; // три місяці
  const rooms = ['Кімната 1', 'Кімната 2', 'Кімната 3'];

  for (let i = 0; i < daysToGenerate; i += 2) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    const formattedDate = `${String(date.getDate()).padStart(2, '0')}.${String(date.getMonth() + 1).padStart(2, '0')}.${date.getFullYear()}`;
    const room = rooms[(i / 2) % rooms.length];
    entries.push({ date: formattedDate, room: room });
  }

  // Генеруємо таблицю
  async function generateTable() {
    for (const entry of entries) {
      const row = document.createElement('tr');
      const checkboxId = `${entry.date}_${entry.room}`.replace(/\s+/g, '_');
      row.innerHTML = `
        <td>${entry.date}</td>
        <td>${entry.room}</td>
        <td><input type="checkbox" id="${checkboxId}"></td>
      `;
      tableBody.appendChild(row);

      // Завантаження з Firebase
      const docRef = db.collection("cleaning_schedule").doc(checkboxId);
      const docSnap = await docRef.get();
      if (docSnap.exists) {
        document.getElementById(checkboxId).checked = docSnap.data().is_cleaned;
      }
    }
  }

  generateTable(); // викликаємо генерацію

  // Обробка збереження
  document.getElementById('cleaningForm').addEventListener('submit', async function (event) {
    event.preventDefault();

    const savePromises = entries.map(entry => {
      const checkboxId = `${entry.date}_${entry.room}`.replace(/\s+/g, '_');
      const isCleaned = document.getElementById(checkboxId).checked;
      const docRef = db.collection("cleaning_schedule").doc(checkboxId);
      return docRef.set({ is_cleaned: isCleaned });
    });

    // Чекаємо на ВСЕ збереження
    try {
      await Promise.all(savePromises);
      showSuccessMessage();
    } catch (error) {
      alert('Помилка при збереженні: ' + error.message);
      console.error(error);
    }
  });

  function showSuccessMessage() {
    const msg = document.getElementById('successMessage');
    msg.style.display = 'block';
    setTimeout(() => {
      msg.style.display = 'none';
    }, 3000);
  }
</script>
